<div class="scan-history-section">
  <h2 class="scan-history-title">🕓 Scan History</h2>
  @if (scanHistory.length === 0) {
    <div class="flex flex-col items-center justify-center">
      <span class="scan-history-icon">
        <!-- SVG icon here -->
      </span>
      <p class="scan-history-empty">No previous scans found</p>
      <small class="scan-history-description">Your scan history will appear here</small>
    </div>
  } @else {
    <ul class="scan-history-list">
      @for (item of scanHistory; track item) {
        <li class="scan-history-item">
          <div class="scan-header">
            <div class="scan-url">
              <strong>{{ item.result?.url || item.url }}</strong>
              <span class="scan-time">({{ item.result?.scan_time ? (item.result.scan_time | date:'medium') : (item.time | date:'medium') }})</span>
            </div>
            <div class="scan-risk-level">
              <b>Risk Level:</b> {{ item.result?.risk_level || 'N/A' }}
            </div>
            <div class="scan-most-common-owasp" *ngIf="item.result?.most_common_owasp">
              <b>Most Common OWASP:</b> {{ item.result.most_common_owasp }}
            </div>
            <div class="scan-alerts">
              <b>Alerts:</b> {{ item.result?.alerts?.length || 0 }}
            </div>
            <!-- ML Result removed -->
          </div>
          <div class="scan-section-details" *ngIf="item.result?.alerts && item.result.alerts.length">
            <h4 class="scan-section-title">Alerts Detail</h4>
            <ul class="alert-list">
              <li *ngFor="let alert of item.result.alerts" [ngClass]="{'alert-high': alert.risk && alert.risk.toLowerCase() === 'high'}">
                <ng-container *ngIf="alert.name">
                  <b>{{ alert.name }}</b> - {{ alert.risk }}<br>
                  <span *ngIf="alert.description">{{ alert.description }}</span>
                </ng-container>
                <ng-container *ngIf="!alert.name">
                  {{ alert | json }}
                </ng-container>
              </li>
            </ul>
          </div>
          <!-- Spider Data and Active Scan Data removed -->
          <!-- All Alerts from ES removed -->
          <div class="scan-section-details" *ngIf="item.error">
            <div class="error-message">{{ item.error }}</div>
          </div>
          <!-- Nút AI Phân Tích ở góc dưới phải -->
          <button class="ai-analyze-btn" title="Nhờ AI phân tích">
            <span class="ai-icon" aria-hidden="true">
              <!-- SVG robot icon -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="7" width="14" height="8" rx="3" fill="#60a5fa"/>
                <rect x="7.5" y="2" width="5" height="5" rx="2.5" fill="#38bdf8"/>
                <circle cx="7" cy="11" r="1" fill="#fff"/>
                <circle cx="13" cy="11" r="1" fill="#fff"/>
                <rect x="1" y="10" width="2" height="3" rx="1" fill="#60a5fa"/>
                <rect x="17" y="10" width="2" height="3" rx="1" fill="#60a5fa"/>
              </svg>
            </span>
            <span class="ai-label">Phân tích</span>
          </button>
        </li>
      }
    </ul>
  }
</div>
